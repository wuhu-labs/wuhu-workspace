---
title: "Add right-click rename for sessions in WuhuMVPApp"
status: done
priority: medium
---

## Context

The sessions list in WuhuMVPApp (`SessionListView` in `SessionFeature.swift`)
currently displays session titles derived from the first user message
(`TranscriptConverter.deriveSessionTitle`). There is no way for the user to
rename a session — the title is always auto-generated.

Users should be able to right-click a session row in the list, choose "Rename",
and edit the title in a dialog (e.g., an `.alert` with a text field or a
`.sheet`). The renamed title should persist and take priority over the
auto-derived title on subsequent loads.

## Tasks

### Backend / API layer

- Add a rename/update endpoint to the server (e.g.,
  `PATCH /v1/sessions/:id` with a JSON body `{ "title": "..." }`), or add a
  `title` field to the existing session update mechanism.
- Persist the custom title on `WuhuSession` so it survives server restarts and
  is returned by `GET /v1/sessions/:id` and `GET /v1/sessions`.
- `WuhuClient` needs a new method, e.g.,
  `renameSession(id: String, title: String) async throws`.

### WuhuMVPApp

- Add `renameSession` to `APIClient` in `APIClient.swift` (with live and
  preview implementations).
- Add a context menu to `SessionRow` (or `SessionListView`'s `ForEach`) with a
  "Rename" action.
- Present a rename dialog (alert with text field or a small sheet) pre-filled
  with the current title. On confirm, fire a new `SessionFeature.Action`
  (e.g., `.renameSession(id:, newTitle:)`).
- In `SessionFeature`, handle the action: optimistically update
  `MockSession.title` in state, call the API, and roll back on failure.
- Ensure the custom title is preserved across refresh cycles — the merge logic
  in `AppFeature.refreshDataLoaded` already preserves existing session fields,
  but verify that a user-set title is not overwritten by the auto-derived one.

## Files to study

- `WuhuMVPApp/Sources/SessionFeature.swift` — `SessionListView`, `SessionRow`,
  `SessionFeature` reducer
- `WuhuMVPApp/Sources/AppFeature.swift` — `refreshDataLoaded` merge logic for
  sessions
- `WuhuMVPApp/Sources/APIClient.swift` — `APIClient` dependency, conversion
  helpers, `MockSession.from`
- `WuhuMVPApp/Sources/MockData.swift` — `MockSession` model (check for
  `title` field)
