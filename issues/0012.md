---
title: async_bash completion notification must be guaranteed ("will", not "may")
status: open
---

The current `async_bash` tool contract/documentation indicates that when the
background task finishes, Wuhu *may* insert a user-level JSON message into the
session transcript.

This should be a strict guarantee:

- When an `async_bash` task finishes (success or failure), Wuhu **will** append a
  completion message (role `user` at the LLM level) to the transcript.
- Agents should not need to poll `async_bash_status` to learn that a task has
  finished; polling should only be an optional/extra capability.

Acceptance criteria:

1. Update tool docs/specs to say **will** (not *may*) and describe the completion
   JSON payload.
2. Ensure the runtime implementation reliably emits the completion message even
   if the model is mid-response / not polling.
3. Add an integration test (or harness test) that starts `async_bash` with e.g.
   `sleep 2 && echo done`, does not poll, and verifies the completion message is
   delivered.

Notes:

- This is a follow-up to WUHU-0010 now that `async_bash` exists; the remaining
  issue is the reliability/guarantee of the completion notification and the
  contract wording.
