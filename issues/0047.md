---
title: "Make session environment optional, support mount-free sessions"
status: done
assignee: agent
priority: high
parent: "0045"
---

# WUHU-0047: Make session environment optional, support mount-free sessions

## Summary

Decouple sessions from environments. A session can start with no mount
(pure chat) and optionally acquire one later.

## Changes

### WuhuSession

- `environment: WuhuEnvironment` → removed (replaced by mounts table)
- `cwd: String` → `cwd: String?` (nil when no mount)
- `environmentID: String?` → removed (replaced by mount's `mountTemplateID`)
- Add computed helper: `primaryMount` (looked up from mounts)

### WuhuCreateSessionRequest

- `environment: String?` → `mountTemplate: String?` (optional)
- `environmentPath: String?` → `mountPath: String?` (optional)
- Both are optional. If neither is provided, session starts mount-free.

### Session creation flow

1. No mount info provided → session created with no mount, no filesystem tools
2. `mountPath` provided → direct mount created, recorded in `mounts` table
3. `mountTemplate` provided → template resolved, directory materialized,
   mount recorded

### Agent tool: `mount`

New tool available to all sessions:

```
mount(path: "/Users/minsheng/Developer/pi-mono")
```

Creates a direct mount mid-session. System injects AGENTS.md/skills as
transcript entries (see WUHU-0048). Tools become available (or re-scoped
to new primary mount).

## Backward compatibility

Existing sessions in the database have `environment*` columns. Migration
(WUHU-0053) moves these into the `mounts` table. Old API callers using
`environment` field continue to work during a transition period.
