---
title: "Extract PiAI into wuhu-ai repo + create umbrella repo"
status: done
assignee: agent
priority: high
---

# WUHU-0041: Extract PiAI into wuhu-ai repo + create umbrella repo

## Goal

Begin the multi-repo split. Two new repos today:

1. **wuhu-labs/wuhu-ai** — The PiAI library as its own package.
2. **wuhu-labs/wuhu-umbrella** — The parent repo that ties all repos together.

Then update **wuhu-swift** to consume `wuhu-ai` as a dependency instead of
embedding PiAI source.

## Part 1: wuhu-ai

Create `wuhu-labs/wuhu-ai` on GitHub.

### What goes in

- `Sources/PiAI/` (all files, unchanged)
- `Tests/PiAITests/` (all files, unchanged)
- New `Package.swift` with:
  - Package name: `wuhu-ai`
  - Single library product: `PiAI`
  - Dependency: `async-http-client` (the only external dep PiAI uses)
  - platforms: `.macOS(.v14), .iOS(.v16)`
  - Swift tools version 6.2
  - Same strict concurrency settings
- `README.md` with basic usage
- `LICENSE` (match wuhu-swift)

### CI

GitHub Actions workflow:
- **Linux**: swift 6.2 on Ubuntu (this is the important one — server runs Linux)
- **macOS**: swift 6.2 on macOS (nice to have for confidence, add it)
- Runs `swift build` and `swift test`
- Branch protection on `main`: require CI to pass

### Tag

Tag `0.1.0` once CI is green.

## Part 2: wuhu-umbrella

Create `wuhu-labs/wuhu-umbrella` on GitHub.

### Contents

- `repos.yml` — manifest listing all repos (just `wuhu-ai` and `wuhu` for now)
- `sync.ts` — Bun script that clones/pulls repos from manifest
- `AGENTS.md` — shared dev context for agents working across repos
- `.gitignore` — ignore all child repo directories

Structure after sync:

```
wuhu-umbrella/
  AGENTS.md
  repos.yml
  sync.ts
  .gitignore
  ai/               # clone of wuhu-ai (gitignored)
  wuhu/              # clone of wuhu-swift (gitignored)
```

### repos.yml

```yaml
repos:
  - name: ai
    url: git@github.com:wuhu-labs/wuhu-ai.git
    branch: main
    path: ai
  - name: wuhu
    url: git@github.com:wuhu-labs/wuhu-swift.git
    branch: main
    path: wuhu
```

## Part 3: Update wuhu-swift

Remove embedded PiAI source and consume it as a package dependency.

- Delete `Sources/PiAI/` and `Tests/PiAITests/`
- Add to `Package.swift` dependencies:
  ```swift
  .package(url: "https://github.com/wuhu-labs/wuhu-ai.git", from: "0.1.0")
  ```
- Replace the `PiAI` target with a product dependency:
  ```swift
  .product(name: "PiAI", package: "wuhu-ai")
  ```
  everywhere PiAI is referenced as a target dependency
- Remove the `.library(name: "PiAI", ...)` product (no longer ours to vend)
- Remove the `PiAITests` test target
- Verify `swift build` and `swift test` pass

## What's NOT in scope

- Moving the agent loop / WuhuCore into wuhu-ai (future)
- Splitting out wuhu-workspace or wuhu-core (future issues)
- Folder-template environment for the umbrella (future)
- WuhuApp changes (it already depends on PiAI via the SPM package; once
  wuhu-swift drops the embedded target, WuhuApp's project.yml will need
  updating — but that's a follow-up)

## Validation

- [ ] `wuhu-ai`: CI green on Linux + macOS, tagged 0.1.0
- [ ] `wuhu-umbrella`: `bun sync.ts` clones both repos successfully
- [ ] `wuhu-swift`: `swift build` and `swift test` pass with PiAI as external dep
