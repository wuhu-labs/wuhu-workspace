---
title: "Add Stop Session control to WuhuMVPApp UI"
status: closed
priority: high
---

## Context

WuhuMVPApp currently lets users view sessions and send messages, but it does not expose the ability to stop a running session from the UI.

The API surface already exists:

- `APIClient.stopSession(_ sessionID: String) async throws -> WuhuStopSessionResponse`
  - implemented in `WuhuMVPApp/Sources/APIClient.swift` and backed by `WuhuClient.stopSession(sessionID:)`.

## Requirements

### 1) Add a Stop control in Session detail UI

In the session detail view toolbar (or another clearly discoverable location), add a **Stop** button:

- Visible when a session is selected.
- Preferably only enabled (or only shown) when the session execution status is `.running`.
- Use clear labeling and/or an SF Symbol (e.g. `stop.circle` / `stop.circle.fill`).

### 2) Wire Stop to the API

Add TCA plumbing so tapping Stop triggers an async effect calling:

- `apiClient.stopSession(sessionID)`

Handle response + errors.

### 3) UX details

- Show an in-flight state (disable the Stop button and/or show a `ProgressView`) while the stop request is running.
- If the stop request fails, present an error in a user-visible way (alert, inline error text, etc.).
- Optional but recommended: confirmation dialog ("Stop this session?") to avoid accidental stops.

### 4) Ensure UI state updates after stop

After Stop succeeds, the UI should reflect that the session is no longer running.

Acceptable approaches:

- Rely on subscription `statusUpdated` events to update `SessionFeature.State.status`, OR
- Optimistically update local state on success (and still accept subsequent subscription updates).

## Files to Change

- `WuhuMVPApp/Sources/SessionFeature.swift`
  - Add actions/state for stopping
  - Add toolbar button + loading/error presentation
  - Trigger `apiClient.stopSession` effect
- (Potentially) `WuhuMVPApp/Sources/AppFeature.swift` if Stop is owned at the app level (but prefer keeping it session-scoped)

## Acceptance Criteria

- [ ] When a session is selected and running, the UI shows a Stop control
- [ ] Tapping Stop issues `stopSession` against the server
- [ ] Stop control is disabled/shows progress while request is in flight
- [ ] Errors are surfaced to the user
- [ ] After success, session status reflects stopped (via subscription or optimistic update)
- [ ] Build passes:
  - `xcodebuild build -project WuhuMVPApp/WuhuMVPApp.xcodeproj -scheme WuhuMVPApp -destination 'platform=macOS' -quiet`
