---
title: "Move skills and AGENTS.md from system prompt to transcript entries"
status: done
assignee: agent
priority: high
parent: "0045"
---

# WUHU-0048: Move skills and AGENTS.md from system prompt to transcript entries

## Summary

System prompt becomes pure identity. Skills and AGENTS.md become user-role
transcript entries emitted at mount time, in temporal order.

## Current behavior

- System prompt = identity text + skills XML (baked at session creation)
- AGENTS.md = live-reloaded every turn by `WuhuAgentsContextActor`, injected
  into the prompt but never persisted
- Skills loaded from three layers: user, workspace, project

## New behavior

### System prompt (role: system)

Just the identity. Nothing else:

```
You are a coding agent.
Use tools to inspect and modify the repository in your working directory.
Prefer read/grep/find/ls over guessing file contents.
When making changes, use edit for surgical replacements and write for new files.
Use bash to run builds/tests and gather precise outputs.
Use async_bash to start long-running commands in the background, and async_bash_status to check their status.
```

### Mount context (transcript entries)

When a mount is created, the system emits user-role transcript entries:

```
[entry N]   mount announcement: "Mounted 'wuhu-core' at /path/..."
[entry N+1] AGENTS.md content (if found)
[entry N+2] skills XML (if any found)
```

These are persisted in `session_entries` as regular entries. They appear in
temporal order — if a mount happens at turn 47, the context appears at turn 47.

For sessions that start with a mount, these entries appear right after the
header, before the first user message.

### What gets deleted

- `WuhuAgentsContextActor` — the entire actor, caching, stat-gating
- `WuhuSessionRuntimeConfig.setContextActor` / `_contextActor`
- Skills injection into system prompt in `SQLiteSessionStore.createSession`
- Skills metadata in header entry

### Live-reload

Dropped. AGENTS.md and skills are loaded once at mount time. If they change,
a steer notification can be sent to alert the agent. No polling, no hidden
mutation.

### Workspace context

The workspace root (`~/.wuhu/workspace/`) gets its own AGENTS.md/skills
loading at session start, independent of any mount. This is emitted as
transcript entries before any mount context.
