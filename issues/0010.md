---
title: Async background shell tool
status: open
---

I need you to add a new async_bash tool. It is similar to the current bash tool,
but it runs the task in the background:

1. The tool call would start the task, and return immediately
2. It returns with an JSON dictionary with two fields

```json
{
  "id": "some random generated task id",
  "message": "Task has been started successfully. When it is finished, you will receive a message from the system. You do not need to wait or poll for it."
}
```

You can rephrase the above message if it sounds unnatural or unclear.

WuhuCore should track this process. When it finishes, with exit code zero or
not, it should append a message entry, with role set to "user" at LLM level. It
should be a simple JSON message, that includes

- id, for the agent to know which task has finished
- started_at, ended_at, duration
- the exit code and output, identical to the current bash tool

Implement this tool by automatically redirecting the stdout and stderr to
individual files.

Add another tool to allow the user to query the status of an async task. This
tool should return whether the task is running or finished, and PID if it is
still running. It should also inlcude the stdout and stderr file -- so the model
could decide to check the status if they need.

One thing to watch for: if the model is still working when a task is finished,
you need to insert the response as soon as possible. Do not delay till the model
has finished processing. You should take a look at how pi-mono implements the
steer queue thing. Document your design in DocC. We will soon add a similar
queue thing ourselves -- we won't do it now, but it helps if your design
naturally leaves space for that.

You should test this. You can instruct the model to call sleep, with, say 15
seconds:

sleep 15 && echo '15 seconds have passed'

You can use the CLI client tool to drive the model, wait for 20 seconds, and see
if the model responds after the async bash finishes.
