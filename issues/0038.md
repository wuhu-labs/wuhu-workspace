---
title: "Consider merging WuhuCoreClient into WuhuAPI"
status: open
assignee:
priority: low
---

# WUHU-0038: Consider merging WuhuCoreClient into WuhuAPI

## Context

WUHU-0037 introduced `WuhuCoreClient` to extract the client-safe subset of
`WuhuCore` (session contracts, queue types, identifiers, `RemoteSessionSSETransport`)
so the iOS app doesn't need to pull in GRDB and server-side code.

This works, but `WuhuCoreClient` is arguably just more shared types â€” the same
role `WuhuAPI` already plays. Having both feels like one module too many.

## Proposal

Merge `WuhuCoreClient` into `WuhuAPI`, eliminating the extra target.

## Complications

- **Circular dependency risk:** `WuhuCoreClient` currently depends on both
  `PiAI` and `WuhuAPI`. Merging into `WuhuAPI` means the contract types that
  reference `WuhuSessionEntry`, `WuhuProvider`, etc. would need to coexist in
  the same module. Likely fine, but needs verification.
- **`RemoteSessionSSETransport`** is a ~340-line actor with retry logic and
  connection state management. It's more "client infrastructure" than "wire
  types." May feel out of place in a module called `WuhuAPI`.
- **Naming:** If `WuhuAPI` grows beyond wire types, the name might need
  revisiting too. Or keep the name and accept it's "the shared layer."

## Decision needed

- Is the right boundary `WuhuAPI` = everything shared, or should there be a
  distinction between wire types and client-side transport logic?
- If merging, should `WuhuAPI` be renamed (e.g. `WuhuShared`, `WuhuCommon`)?
  Or is `WuhuAPI` fine as-is?
