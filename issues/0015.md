---
title: Sunset PiAgent module, move tool types into WuhuCore
status: open
---

## Context & Intent

PiAgent was the original agent module — it contains an `Agent` actor, streaming
loop primitives (`agentLoop()`), event types, and tool types (`AnyAgentTool`,
`AgentToolResult`).

The `Agent` actor is dead code. The new `AgentLoop<B: AgentBehavior>` in
`WuhuCore/Contracts/` replaced it entirely. But PiAgent still exists as a
module because WuhuCore re-exports it (`@_exported import PiAgent` in
`Exports.swift`) for the tool types. 13 files across WuhuCore, WuhuServer,
and tests import PiAgent.

This is confusing. Two things named "agent loop" in two modules. A module
called "PiAgent" that's really just a tool type library. Kill it.

### Contracts vs Alignment

The `Contracts/` directory should only contain the interfaces that the human
needs to align with LLM agents — `AgentBehavior`, `AgentLoopContracts`,
observation types. It is **not** a dumping ground for all protocol/type
definitions. Tool types like `AnyAgentTool` and `AgentToolResult` do not
belong in `Contracts/`. They are Wuhu domain types, not alignment surfaces.
(`Contracts/` may be renamed to `Alignment/` in the future to make this
distinction sharper.)

Tool types should land in WuhuCore as regular domain types — alongside
`CodingAgentTools.swift`, `WuhuTools.swift`, etc. They are part of Wuhu's
tool infrastructure, not part of the AgentLoop abstraction.

## Tasks

- Move `AnyAgentTool`, `AgentToolResult`, and any other reusable types from
  `Sources/PiAgent/AgentTool.swift` into WuhuCore as regular source files
  (not under `Contracts/`). These are Wuhu domain types.
- Delete the `PiAgent` module entirely: `Sources/PiAgent/`, its target in
  `Package.swift`, the `@_exported import PiAgent` in `Exports.swift`.
- Delete `Tests/PiAgentTests/` — the old `Agent` actor tests are testing dead
  code.
- Update all `import PiAgent` sites (13 files) to remove the import. Since
  WuhuCore will own the types directly, most of these just drop the import line.
  WuhuServer files that imported PiAgent for tool types now get them through
  WuhuCore.
- Verify no naming collisions between the moved types and existing WuhuCore
  symbols.

## Files to Study

- `Sources/PiAgent/` — everything here dies, but study `AgentTool.swift` to
  understand what needs to be preserved
- `Sources/WuhuCore/Exports.swift` — the `@_exported import PiAgent` bridge
- `Sources/WuhuCore/CodingAgentTools.swift` — existing tool definitions,
  natural home for the moved types
- `Sources/WuhuCore/WuhuTools.swift` — same
- `Sources/WuhuCore/Contracts/` — do NOT put tool types here
- `Package.swift` — PiAgent target and all dependency edges to remove

## Success Criteria

- `PiAgent` module does not exist (no `Sources/PiAgent/`, no target in
  `Package.swift`)
- `Tests/PiAgentTests/` does not exist
- `git grep 'import PiAgent'` returns nothing
- `git grep 'PiAgent'` returns nothing (outside of git history)
- `AnyAgentTool` and `AgentToolResult` live in WuhuCore as regular source
  files, not under `Contracts/`
- `Contracts/` contains only alignment interfaces (`AgentBehavior`,
  `AgentLoopContracts`, observation types, etc.)
- `swift build` succeeds
- `swift test` passes
